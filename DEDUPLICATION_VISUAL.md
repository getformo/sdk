# Event Deduplication - Visual Explanation

## Timeline Comparison

### âŒ BEFORE THE FIX

```
Time:         10:30:00    10:30:15    10:30:25    10:30:45    10:31:00
              â”‚           â”‚           â”‚           â”‚           â”‚
Event Flow:   â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Submit #1 â”€â”€â”€â”€â”¤           â”‚           â”‚           â”‚           â”‚
  [Queued]    â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚   Queue   â”‚           â”‚           â”‚           â”‚
              â”‚   [1 ev]  â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Submit #2 â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚           â”‚           â”‚
  [Queued]    â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚   Queue   â”‚           â”‚           â”‚           â”‚
              â”‚   [2 ev]  â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚  FLUSH!   â”‚           â”‚           â”‚
              â”‚           â”‚  Sent: 2  â”‚           â”‚           â”‚
              â”‚           â”‚  CLEARED  â”‚           â”‚           â”‚
              â”‚           â”‚  Hash Set â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Submit #3 â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
  [Queued]    â”‚           â”‚           â”‚           â”‚           â”‚
  âš ï¸ DUPLICATEâ”‚           â”‚           â”‚           â”‚           â”‚
  NOT DETECTEDâ”‚           â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚  Queue    â”‚           â”‚
              â”‚           â”‚           â”‚  [1 ev]   â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚  FLUSH!   â”‚
              â”‚           â”‚           â”‚           â”‚  Sent: 1  â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Result:       ğŸ”´ 3 identical events sent (Submit #1, #2, #3)
```

### âœ… AFTER THE FIX

```
Time:         10:30:00    10:30:15    10:30:25    10:30:45    10:31:05
              â”‚           â”‚           â”‚           â”‚           â”‚
Event Flow:   â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Submit #1 â”€â”€â”€â”€â”¤           â”‚           â”‚           â”‚           â”‚
  [Queued]    â”‚           â”‚           â”‚           â”‚           â”‚
  Hash: abc   â”‚           â”‚           â”‚           â”‚           â”‚
  Time: :00   â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚   Queue   â”‚           â”‚           â”‚           â”‚
              â”‚   [1 ev]  â”‚           â”‚           â”‚           â”‚
              â”‚   Hashes  â”‚           â”‚           â”‚           â”‚
              â”‚   abc:00  â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Submit #2 â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚           â”‚           â”‚
  âŒ BLOCKED  â”‚           â”‚           â”‚           â”‚           â”‚
  Same Hash!  â”‚           â”‚           â”‚           â”‚           â”‚
  "Sent 15s   â”‚           â”‚           â”‚           â”‚           â”‚
   ago"       â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚   Queue   â”‚           â”‚           â”‚           â”‚
              â”‚   [1 ev]  â”‚           â”‚           â”‚           â”‚
              â”‚   Hashes  â”‚           â”‚           â”‚           â”‚
              â”‚   abc:00  â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚  FLUSH!   â”‚           â”‚           â”‚
              â”‚           â”‚  Sent: 1  â”‚           â”‚           â”‚
              â”‚           â”‚  PRESERVEDâ”‚           â”‚           â”‚
              â”‚           â”‚  Hash Set â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Submit #3 â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
  âŒ BLOCKED  â”‚           â”‚           â”‚           â”‚           â”‚
  Same Hash!  â”‚           â”‚           â”‚           â”‚           â”‚
  "Sent 45s   â”‚           â”‚           â”‚           â”‚           â”‚
   ago"       â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚   Queue   â”‚           â”‚           â”‚           â”‚
              â”‚   [0 ev]  â”‚           â”‚           â”‚           â”‚
              â”‚   Hashes  â”‚           â”‚           â”‚           â”‚
              â”‚   abc:00  â”‚           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Submit #4 â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  [Queued]    â”‚           â”‚           â”‚           â”‚           â”‚
  65s later   â”‚           â”‚           â”‚           â”‚           â”‚
  âœ… ALLOWED  â”‚           â”‚           â”‚           â”‚           â”‚
  Outside 60s â”‚           â”‚           â”‚           â”‚           â”‚
              â”‚   Queue   â”‚           â”‚           â”‚           â”‚
              â”‚   [1 ev]  â”‚           â”‚           â”‚           â”‚
              â”‚   Hashes  â”‚           â”‚           â”‚           â”‚
              â”‚   abc:05  â”‚           â”‚           â”‚           â”‚
              â”‚   (abc:00 â”‚           â”‚           â”‚           â”‚
              â”‚    cleaned)           â”‚           â”‚           â”‚
              â”‚           â”‚           â”‚           â”‚           â”‚
Result:       ğŸŸ¢ 2 events sent (Submit #1, #4) - 50% reduction!
```

## Hash Generation Comparison

### âŒ BEFORE (Minute Precision)

```
Event at 10:30:15.123:
{
  event: "transaction_submit",
  properties: { type: "swap" },
  timestamp: "2025-01-01 10:30"  â† Rounded to minute
  ...
}
â†“
Hash: "abc123def456"

Event at 10:30:45.789:
{
  event: "transaction_submit",
  properties: { type: "swap" },
  timestamp: "2025-01-01 10:30"  â† Same minute!
  ...
}
â†“
Hash: "abc123def456"  â† SAME HASH but sent anyway (hash set cleared)
```

### âœ… AFTER (Second Precision)

```
Event at 10:30:15.123:
{
  event: "transaction_submit",
  properties: { type: "swap" },
  timestamp: "2025-01-01 10:30:15"  â† Rounded to second
  ...
}
â†“
Hash: "abc123def456"
Stored: { "abc123def456": timestamp_10:30:15 }

Event at 10:30:15.789:  (Same second)
{
  event: "transaction_submit",
  properties: { type: "swap" },
  timestamp: "2025-01-01 10:30:15"  â† Same second
  ...
}
â†“
Hash: "abc123def456"  â† SAME HASH
Check: Hash exists + within 60s = BLOCKED! âœ…

Event at 10:30:16.000:  (Different second)
{
  event: "transaction_submit",
  properties: { type: "swap" },
  timestamp: "2025-01-01 10:30:16"  â† Different second
  ...
}
â†“
Hash: "xyz789abc123"  â† DIFFERENT HASH
Check: Hash doesn't exist = ALLOWED âœ…
```

## Hash Cleanup Process

### Old Behavior (Cleared on Flush)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hash Set                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  abc123: (event 1)                      â”‚
â”‚  def456: (event 2)                      â”‚
â”‚  ghi789: (event 3)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Flush triggered
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hash Set                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [EMPTY]  â† All hashes cleared!         â”‚
â”‚  âš ï¸ Lost deduplication!                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### New Behavior (Time-Based Cleanup)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hash Map                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  abc123: timestamp 10:30:00             â”‚
â”‚  def456: timestamp 10:30:15             â”‚
â”‚  ghi789: timestamp 10:30:30             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Flush triggered at 10:30:40
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hash Map                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  abc123: timestamp 10:30:00             â”‚
â”‚  def456: timestamp 10:30:15             â”‚
â”‚  ghi789: timestamp 10:30:30             â”‚
â”‚  âœ… Hashes preserved!                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ New event at 10:31:05
                  â”‚ Cleanup old hashes (> 60s)
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hash Map                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [abc123 removed - 65s old]             â”‚
â”‚  def456: timestamp 10:30:15 (50s old)   â”‚
â”‚  ghi789: timestamp 10:30:30 (35s old)   â”‚
â”‚  jkl012: timestamp 10:31:05 (new)       â”‚
â”‚  âœ… Auto cleanup!                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Real-World Transaction Flow

### Typical Transaction Lifecycle

```
User Action                 SDK Event                    Status
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

User clicks                 
"Submit" button             
    â”‚                       
    â†“                       
[App calls                  track("transaction_submit")  âœ… Queued
 analytics.track]           Hash: xxx111                 Time: 0s
    â”‚                       
    â†“                       
[User confirms              
 in wallet]                 
    â”‚                       
    â†“                       
[Transaction                track("transaction_success") âœ… Queued
 success]                   Hash: yyy222                 Time: 5s
    â”‚                       Different event name!        
    â†“                       
                            
â”€â”€ React re-renders â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚                       
    â†“                       
[Component                  track("transaction_submit")  âŒ BLOCKED
 re-renders]                Hash: xxx111                 "Sent 7s ago"
    â”‚                       Same as first!               
    â†“                       
                            
â”€â”€ User does another txn â”€â”€â”€
    â”‚                       
    â†“                       
User clicks                 
"Submit" again              
    â”‚                       
    â†“                       
[App calls                  track("transaction_submit")  âœ… Queued
 analytics.track]           Hash: zzz333                 Time: 70s
    â”‚                       Outside 60s window!          
    â†“                       

Result: 3 events sent (submit #1, success, submit #2)
        1 event blocked (duplicate submit)
```

## Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Your Application                                            â”‚
â”‚                                                              â”‚
â”‚  analytics.track("transaction_submit", { type: "swap" })    â”‚
â”‚                                     â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EventManager.addEvent()                                     â”‚
â”‚  - Validates event                                           â”‚
â”‚  - Adds user context                                         â”‚
â”‚                                     â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EventQueue.enqueue()                                        â”‚
â”‚                                                              â”‚
â”‚  1. generateMessageId()                                      â”‚
â”‚     - Format timestamp to second precision                   â”‚
â”‚     - Stringify event with formatted timestamp               â”‚
â”‚     - Generate SHA-256 hash                                  â”‚
â”‚                                                              â”‚
â”‚  2. isDuplicate()                                            â”‚
â”‚     - Clean up old hashes (> 60s)                            â”‚
â”‚     - Check if hash exists                                   â”‚
â”‚       YES â†’ Block event, log warning                         â”‚
â”‚       NO  â†’ Add to queue, store hash with timestamp          â”‚
â”‚                                     â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â†“ (When flush conditions met)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EventQueue.flush()                                          â”‚
â”‚  - Batch events                                              â”‚
â”‚  - Send to API                                               â”‚
â”‚  - DON'T clear hash map (preserved for deduplication)        â”‚
â”‚                                     â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Analytics API                                               â”‚
â”‚  - Receives only unique events                               â”‚
â”‚  - No server-side deduplication needed                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Memory Management

```
Hash Map Growth Over Time:

Minute 0:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5 events â”‚  ~40 bytes per entry = 200 bytes
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Minute 1:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5 events â”‚  (new)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5 events â”‚  (from minute 0, still < 60s old)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Total: 10 events = 400 bytes

Minute 2:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5 events â”‚  (new)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5 events â”‚  (from minute 1, still < 60s old)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0 events â”‚  (from minute 0, CLEANED - > 60s)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Total: 10 events = 400 bytes (stable!)

Even with 1000 events per minute:
- Only 1 minute of events stored
- ~40 bytes per entry
- 1000 events Ã— 40 bytes = 40 KB
- Minimal memory impact!
```

## Key Takeaways

1. **Hashes persist across flushes** - No more duplicate events after queue flush
2. **60-second window** - Recent duplicates caught, old events allowed
3. **Second-level precision** - Better granularity than minute-level
4. **Auto cleanup** - No manual intervention needed, memory efficient
5. **Clear warnings** - Know when duplicates are blocked

## Visual Cheat Sheet

```
âœ… ALLOWED                         âŒ BLOCKED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Different event names            â€¢ Same event within 60s
â€¢ Different properties             â€¢ Identical all fields
â€¢ Outside 60s window               â€¢ Within deduplication window
â€¢ Different addresses/users        â€¢ Rapid fire (< 1s apart)
```

